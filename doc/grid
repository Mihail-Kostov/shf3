How to build a VirtualBox mini cluster

Real life alternatives:
http://xcat.sourceforge.net
MAAS/cobbler/OpenStack/JuJu
http://www.sgi.com/products/software/smc.html

H (host):  OS X
A (admin): Ubuntu
C (compute): Ubuntu

Guest user: op/operator

1.1 Install Ubuntu admin server
  Name: vadmin
  Adapter 1: Host-only adapter, 'vboxnet1'
  Adapter 2: Bridged adapter, en0: Ethernet
  Adapter 3: Bridged adapter, en1: AirPort
  Adapter 4: Internal network, 'intnet'

  /etc/network/interfaces:
  $HOME/shf3/etc/network/interfaces
  
  Enable SSH

1.2 Install VirtualBox Additions:
  A$ sudo apt-get install -y dkms build-essential \
         linux-headers-generic linux-headers-$(uname -r)
  A$ sudo mount /dev/cdrom /media/cdrom
  A$ sudo /media/cdrom/VBoxLinuxAdditions.run


1.3 Install Ubuntu compute node seed or clone vadmin
  Name: vm1
  (Install VirtualBox Additions)
  H$ gmgr start seed
  Set seed sudoers:
  /etc/sudoers.d/operator:
  op ALL=(ALL) NOPASSWD: ALL
  C$ sudo chmod 0440 /etc/sudoers.d/operator
  C$ sudo chown root.root /etc/sudoers.d/operator
  H$ gmgr stop seed


1.4 Clone N-1 compute nodes from the seed
  H$ gmgr clone vm1 3


1.5 Set DHCP on vadmin
  http://www.techrepublic.com/blog/opensource/using-dnsmasq-for-dns-and-dhcp-services/293
  /etc/dnsmasq.conf:
  interface=eth3
  bind-interfaces
  dhcp-range=10.10.10.11,10.10.10.254
  dhcp-option=3,10.10.10.10
  dhcp-lease-max=1000
  dhcp-authoritative
  address=/vadmin/10.10.10.10 

  A$ sudo chown -R op.root /etc/dnsmasq.d


2.1 Set genders on the Host
  https://computing.llnl.gov/linux/genders.html
  $HOME/shf3/mid/grid/default:
  vadmin  admin,all
  vm[1-3] compute,all


2.2 DHCP/DNS for compute nodes
  # H$ gmgr dhcp 10 compute | sshexec vadmin "cat > /etc/dnsmasq.d/default"
  # H$ sshexec vadmin sudo service dnsmasq restart
  H$ gmgr dnsmasq
  H$ gmgr start compute

  # parallel ssh
  # chef
  # ufw
  # syslog-ng/scribe
  # ganglia cerebro
  # mysql/postgres-xc cluster
  # slurm/mpi
  # hadoop/hdfs
  # mongodb
  # cache
  # app mon supervisond


  Check IPs of the cluster
  $ gmgr ips
  Start/stop/pause the cluster
  $ gmgr start/stop/pause
  Check load
  $ gmgr top
