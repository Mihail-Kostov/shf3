#!/bin/bash
source $(dirname ${BASH_SOURCE})/../lib/header
import gui
import ssh

function help/sshmgr() {
  cat << EOF

SSH MID Manager

Usage: ${gbn} options
              -n MID - new
              -d MID - delete
              -e MID - edit
              -p MID - change password
              -i MID - info
              -u MID - update certificates
              -k - kill ssh agent
              -v - verbose
EOF
  exit ${_false_}
}

### args
_c="LIST"
_m=""
while getopts hvki:n:d:e:p:u: o; do
  case "$o" in
    k) _c="KILL";;
    d) _c="DELETE"; _m=$OPTARG;;
    n) _c="CREATE"; _m=$OPTARG;;
    i) _c="INFO"; _m=$OPTARG;;
    e) _c="EDIT"; _m=$OPTARG;;
    p) _c="PASS"; _m=$OPTARG;;
    u) _c="UPDATE"; _m=$OPTARG;;
    v) gdbg=true;;
    h|*) help/sshmgr;;
  esac
done

### main
echo
msg
gui/line

case "${_c}" in
  KILL)
    _apid=$(ps ax | grep ssh-agent | awk '/\?\?/{print $1}')
    if test "${_apid}" != "" ; then
      msg "Stopping ssh-agent (${_apid})"
      kill ${_apid}
    fi
    ;;
  LIST)
    ssh/mgr "${_c}"
    ;;
  INFO|CREATE|DELETE|EDIT|PASS|UPDATE)
    ssh/mgr "${_c}" "${_m}"
    ;;
esac
